#!/usr/bin/env node

const program = require('commander');
const chalk = require('chalk');
const ora = require('ora');
const download = require('download-git-repo');
const tplObj = require(`${__dirname}/../template`);

program
  .usage('<template-name> [project-name]');
program.parse(process.argv);

if (program.args.length < 1) return program.help();

let templateName = program.args[0];
let projectName = program.args[1];

if (!tplObj[templateName]) {
  console.log(chalk.red('\n Template does not exit!(æ²¡æ¨¡æ¿å•Šè€é“ï¼ï¼ğŸ˜¡) \n '));
  return
}
if (!projectName) {
  console.log(chalk.red('\n Project should not be empty! ï¼ˆé¡¹ç›®åä½ å¾—ç»™èµ·ä¸€ä¸ªå•Šå…„dieğŸ˜¤ï¼‰\n '));
  return
}

url = tplObj[templateName];

console.log(chalk.white('\n Start buliding... ï¼ˆåç¨³ï¼Œè€é“ï¼Œå‘è½¦äº†ï¼ğŸ˜‚ï¼‰\n'));
const spinner = ora("Downloading...");
spinner.start();

download (
  url,
  projectName,
  err => {
    if (err) {
      spinner.fail();
      console.log(chalk.red(`In't not funny,...you're failed. ${err}ï¼ˆå§æ§½ï¼å¤±è´¥äº†ğŸ˜¢ï¼‰`));
      return
    }

    spinner.succeed();
    console.log(chalk.green('\n Greate!Your react-project-template completed (ç‰›é€¼ğŸ‚ï¼æˆåŠŸäº†ï¼ğŸ¤£) !'));
    console.log('\n Let\'s start!');
    console.log(`\n    cd ${projectName} ï¼ˆåˆ‡æ¢ç›®å½•æ’¸ç å»ï¼(ï¿£_,ï¿£ )ï¼‰\n`);
  }
);
